# SSE 测试环境

这个目录包含用于测试 vite-enhanced-proxy 插件 SSE 功能的完整测试环境。

## 目录结构

```
test-sse/
├── server.js          # Express 后端服务器（提供 SSE 端点）
├── index.html         # 前端测试页面
├── vite.config.ts     # Vite 配置（使用代理插件）
├── package.json       # 测试项目依赖
└── README.md          # 本文件
```

## 快速开始

### 1. 构建插件（如果尚未构建）

在项目根目录运行：

```bash
npm run build
```

### 2. 安装测试环境依赖

```bash
cd test-sse
npm install
```

这将安装测试所需的依赖，并链接本地插件。

### 3. 启动后端服务器

在一个终端窗口中运行：

```bash
npm run server
```

后端服务器将在 `http://localhost:3001` 启动，提供以下 SSE 端点：

- `GET /api/sse` - 基础 SSE 端点（每 2 秒发送消息）
- `GET /api/sse/custom-retry` - 自定义重试间隔的 SSE 端点
- `GET /api/sse/error` - 错误测试端点（第 3 条消息会触发错误事件）
- `POST /api/sse/broadcast` - 广播消息到所有连接的客户端
- `GET /health` - 健康检查端点

### 4. 启动前端开发服务器

在另一个终端窗口中运行：

```bash
npm run dev
```

Vite 开发服务器将在 `http://localhost:5173` 启动，并自动打开浏览器。

**或者，使用一键启动（推荐）**：

```bash
npm start
```

这将同时启动后端服务器和前端开发服务器，使用不同颜色区分两个服务的日志输出。

**注意**：如果使用 `npm start`，确保先完成步骤 1 和 2（构建插件和安装依赖）。

## 功能说明

### 前端测试页面功能

1. **连接 SSE** - 连接到选定的 SSE 端点
2. **断开连接** - 断开当前的 SSE 连接
3. **发送广播消息** - 向后端发送广播请求，后端会将消息推送给所有连接的客户端
4. **清空消息** - 清空消息日志
5. **选择端点** - 选择不同的 SSE 端点进行测试

### 测试场景

1. **基础 SSE 连接** - 测试基本的 SSE 连接和消息接收
2. **自定义重试间隔** - 测试 SSE 重试配置
3. **错误处理** - 测试 SSE 错误事件的接收和处理
4. **广播消息** - 测试多客户端场景下的消息广播

### 观察代理插件行为

在运行测试时，你可以在终端中观察到：

- ✅ SSE 连接建立日志
- 📨 SSE 消息接收日志（包含 JSON 美化）
- ❌ SSE 连接错误日志
- 🔄 SSE 重连日志

所有日志都会通过 vite-enhanced-proxy 插件进行记录和格式化。

## 注意事项

1. 确保后端服务器在 `http://localhost:3001` 运行
2. 前端通过 Vite 代理访问后端，实际请求会被代理到 `http://localhost:3001`
3. 可以在浏览器开发者工具的 Network 标签中查看 SSE 连接
4. 查看终端输出以观察代理插件的日志记录

